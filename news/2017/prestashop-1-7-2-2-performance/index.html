<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>About the 1.7.2.2 performance improvement</title>
    <link href="/style.css?1751452955" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    
<meta property="og:title" content="About the 1.7.2.2 performance improvement" />
<meta property="og:description" content="A small line might have gone unnoticed in the PrestaShop 1.7.2.2 release announcement: “1.7 front-end should now be faster than 1.6’s for popular stores”. What does it apply to, and how did we test for such performances? Here’s how." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://build.prestashop-project.org/news/2017/prestashop-1-7-2-2-performance/" />
    <meta property="article:section" content="news" />
    <meta property="article:published_time" content="2017-09-22T01:10:11+02:00" />
    <meta property="article:modified_time" content="2017-09-22T01:10:11+02:00" />

  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image" content="https://build.prestashop-project.org/assets/images/theme/meta-logo-build-2024.png">
<meta name="twitter:title" content="About the 1.7.2.2 performance improvement"/>
<meta name="twitter:description" content="Straight from the horse&#39;s mouth"/>
<meta name="twitter:site" content="@PrestaShopOrg"/>

		<script async src="https://www.googletagmanager.com/gtag/js?id=G-QVW3BYSGJJ"></script>
		<script>
		  var doNotTrack = false;
		  if (!doNotTrack) {
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('consent', 'default', {
			  ad_storage: 'denied',
			  analytics_storage: 'denied',
			  wait_for_update:  500 ,
			  region: ['US-CA', 'BE', 'BG', 'CZ', 'DK', 'DE', 'EE', 'IE', 'GR', 'ES', 'FR', 'HR', 'IT', 'CY', 'LV', 'LT', 'LU', 'HU', 'MT', 'NL', 'AT', 'PL', 'PT', 'RO', 'SI', 'SK', 'FI', 'SE']
			});
			gtag('js', new Date());
			gtag('config', 'G-QVW3BYSGJJ', { 'anonymize_ip':  true  });
		  }
		</script>
	
    
</head>


  <body>

  <header class="site-header">

  <div class="container">
    <div class="row clearfix">

      <div class="menu-button"><i class="icon icon-store"></i></div>
      <div class="search-button"><i class="icon icon-magnifying-glass"></i></div>

      <div id="logo" class="">
        
        <a href="https://build.prestashop-project.org">
          <img src="/assets/images/theme/2024-logo.svg" alt="PrestaShop Developers&#39; blog Logo">
        </a>
      </div>

      <div id="navigation" class="">
        <nav>
  <ul id="main-navigation" class="nav navbar-nav navbar-collapse">
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        News <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/tag/releases/">Latest releases</a></li>
        <li><a href="/tag/core-monthly/">Core Monthly</a></li>
        <li><a href="/tag/event/">Events &amp; Live Updates</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Project <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/tag/8.2/">Articles on 8.2</a></li>
        <li><a href="/tag/8.1/">Articles on 8.1</a></li>
        <li><a href="/tag/8.0/">Articles on 8.0</a></li>
        <li><a href="/tag/1.7/">Articles on 1.7</a></li>
        <li><a href="/tag/1.6/">Articles on 1.6</a></li>
        <li><a href="https://nightly.prestashop-project.org">Nightly Builds</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Contribute <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/howtos/misc/contribute-to-prestashop/">Contributor's guide</a></li>
        <li><a href="http://contributors.prestashop-project.org/">Contributor's page</a></li>
        <li><a href="http://translators.prestashop.com/">Translators' page</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Learn <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/howtos/">How-tos</a></li>
        <li><a href="/tools/">Tools</a></li>
        <li><a href="https://devdocs.prestashop-project.org/">Devdocs</a></li>
        <li><a href="/news/how-to-best-contact-us/">How to best contact us</a></li>
      </ul>
    </li>
    <li class="">
      <a href="/about/">About</a>
    </li>
  </ul>
</nav>

      </div>

      <div id="algolia-container">
        <div class="aa-input-container" id="aa-input-container">
          <input type="search" id="aa-search-input" class="aa-input-search form-control" placeholder="Search..." name="search" autocomplete="off" />
        </div>
      </div>

    </div>
  </div>

</header>


    <div class="page-content">
      <div class="container">
        
  <div class="post">

      <div class="row">
        <div class="col-sm-12">

          <header class="post-header">
            <h1 class="post-title">About the 1.7.2.2 performance improvement</h1>
              
                <h3 class="post-subtitle">Straight from the horse&#39;s mouth</h3>
              
          </header>

        </div>
      </div>


      <div class="row">
        <div id="post-sidebar" class="col-md-2">

          <aside class="author">
              <div class="author-avatar clearfix">
  
  
      <a href="https://build.prestashop-project.org/authors/jocelynfournier/">
        <img class="img-circle" src="https://avatars0.githubusercontent.com/u/1429072" alt="Jocelyn Fournier's picture">
      </a>
  
</div>

<div class="aside-meta">Written by</div>
<div class="author-name">
  
    <div class="author-item">
      <div class="author-display-name">
        <a href="https://build.prestashop-project.org/authors/jocelynfournier/">Jocelyn Fournier</a>
      </div>
        
          <div class="author-display-role">CEO &amp; Founder @ Softizy</div>
        
    </div>
  
</div>

          </aside>

          <aside class="post-meta-sidebar">
              <div class="aside-meta">Published</div>
<p class="publish-date">
    Sep 22, 2017
</p>

          </aside>

          <aside class="share-buttons">
              <div class="aside-meta">Share this</div>

<a href="https://twitter.com/intent/tweet?text=About&#43;the&#43;1.7.2.2&#43;performance&#43;improvement&amp;url=https%3A%2F%2Fbuild.prestashop-project.org%2Fnews%2F2017%2Fprestashop-1-7-2-2-performance%2F&amp;via=PrestaShopOrg&amp;related=PrestaShopOrg" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="icon-twitter-alt"></i>
</a>

<a href="https://facebook.com/sharer.php?u=https%3A%2F%2Fbuild.prestashop-project.org%2Fnews%2F2017%2Fprestashop-1-7-2-2-performance%2F" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="icon-facebook-alt"></i>
</a>

          </aside>

        </div>

        <div class="col-md-10">

          <article class="post-content">

              <p>A small line might have gone unnoticed in the <a href="http://build.prestashop.com/news/prestashop-1-7-2-2-maintenance-release/">PrestaShop 1.7.2.2 release announcement</a>: &ldquo;1.7 front-end should now be faster than 1.6’s for popular stores&rdquo;. What does it apply to, and how did we test for such performances? Here&rsquo;s how.</p>
<p>With the release of PrestaShop 1.7.2.2, we have tried to remove a few point of contention which were affecting badly overall PrestaShop performance:</p>
<ul>
<li>Specific price computation</li>
<li>Bad sale page pagination, which loaded too many products on one page</li>
</ul>
<p>Let&rsquo;s check the specific price improvement!</p>
<h3 id="why-improving-specificprice-is-important-for-performance">Why improving <code>specificPrice()</code> is important for performance?</h3>
<p>According to our internal software, <code>specificPrice()</code> computation was particularly slow, AND present across a lot of pages.</p>
<p>Basically our software crawls a website, profiles each page it finds, then generates a global report. <code>specificPrice()</code> was listed in the top 5 most resource and time consuming operation, overall.</p>
<h3 id="when-can-i-expect-improvements">When can I expect improvements?</h3>
<p>Each time a price is displayed, the <code>specificPrice()</code> method is called. The logic can be greatly optimized when there is no &ldquo;global&rdquo; specific price rule. A global rule means it applies to all your products. Luckily, global rules don&rsquo;t occur that often in a real shop. In this case:</p>
<ul>
<li>If no specific price at all exists for a given product, don&rsquo;t try to compute the <code>specificPrice()</code> (makes sense, doesn&rsquo;t it?)</li>
<li>If a specific price exists for this product, the SQL query will be optimized and executed faster.</li>
</ul>
<p>This also allows to improve the local <code>specificPrice()</code> cache, and greatly reduces the number of SQL queries associated with it.</p>
<h3 id="lets-benchmark-this">Let&rsquo;s benchmark this!</h3>
<h4 id="the-configuration">The configuration</h4>
<p>To do this benchmark, we chose to use a dedicated Mini HG server from OVH, which offers high performances for a fairly decent price:</p>
<ul>
<li>CPU: Intel(R) Xeon(R) CPU E5-2650 v2 @ 2.60 GHz (8 cores, 16 threads)</li>
<li>Memory: 64 GB</li>
<li>Disk: 2x SSD 600 GB</li>
<li>RAID Controller: LSI MegaRAID SAS 9271-4i CacheVault 1G FastPath</li>
</ul>
<p>We used a Debian Wheezy, with the standard, dotdeb &amp; sury.org packages, and a properly optimized configuration:</p>
<ul>
<li>
<p>Apache 2.4.23, with mpm_event and the following configuration:</p>
<ul>
<li>ServerLimit             16</li>
<li>MaxClients              400</li>
<li>StartServers            3</li>
<li>ThreadLimit             64</li>
<li>ThreadsPerChild         25</li>
<li>MaxRequestWorkers       400</li>
<li>MaxConnectionsPerChild  0</li>
</ul>
</li>
<li>
<p>PHP 7.0.23 &amp; APCu + Zend OpCache v7.0.23 PHP-FPM mode with the following configuration:</p>
<ul>
<li>pm =                    dynamic</li>
<li>pm.max_children       = 400</li>
<li>pm.start_servers      = 75</li>
<li>pm.min_spare_servers  = 50</li>
<li>pm.max_spare_servers  = 100</li>
</ul>
</li>
<li>
<p>MariaDB 10.2.8, with the following configuration:</p>
<ul>
<li>performance_schema                    = OFF</li>
<li>innodb_lock_wait_timeout              = 120</li>
<li>default_storage_engine                = InnoDB</li>
<li>max_allowed_packet                    = 16M</li>
<li>key_buffer_size                       = 128M</li>
<li>table_cache                           = 4096</li>
<li>read_buffer_size                      = 2M</li>
<li>read_rnd_buffer_size                  = 1M</li>
<li>thread_cache_size                     = 80</li>
<li>join_buffer_size                      = 2M</li>
<li>sort_buffer_size                      = 2M</li>
<li>max_connections                       = 400</li>
<li>tmp_table_size                        = 32M</li>
<li>max_heap_table_size                   = 32M</li>
<li>table_definition_cache                = 8192</li>
<li>query_cache_size                      = 32M</li>
<li>innodb_buffer_pool_size               = 3G</li>
<li>innodb_log_file_size                  = 128M</li>
<li>innodb_log_files_in_group             = 2</li>
<li>innodb_log_buffer_size                = 8M</li>
<li>innodb_flush_log_at_trx_commit        = 2</li>
<li>innodb_thread_concurrency             = 64</li>
<li>innodb_read_io_threads                = 8</li>
<li>innodb_write_io_threads               = 8</li>
<li>innodb_flush_method                   = O_DIRECT</li>
<li>innodb_file_per_table                 = 1</li>
<li>innodb_io_capacity                    = 2000</li>
<li>innodb_file_format                    = Barracuda</li>
<li>innodb_checksum_algorithm             = crc32</li>
<li>innodb_log_compressed_pages           = 0</li>
<li># SSD</li>
<li>innodb_flush_neighbors                = 0</li>
<li># Mutex contention</li>
<li>innodb_buffer_pool_instances          = 32</li>
</ul>
</li>
</ul>
<p>Memcached is used, configured locally, with 128 MB of memory.</p>
<p>We made a benchmark with <strong>a real shop</strong>, which features:</p>
<ul>
<li>1,904 products</li>
<li>1,827 categories</li>
<li>10,843 cart rules</li>
<li>2M product attributes</li>
<li>16.5M attribute combinations</li>
<li>57 specific prices</li>
</ul>
<p>The benchmarks results are the average of 5 &ldquo;<code>siege -i -b -t 20S</code>&rdquo; (20 s benchmark), on representative pages which have a direct impact on user navigation and SEO:</p>
<ul>
<li>Category pages</li>
<li>Product pages</li>
<li>Home pages</li>
<li>Cart pages</li>
<li>Best sales pages</li>
<li>Tag search pages</li>
<li>Manufacturer pages</li>
<li>New product pages</li>
<li>Price drop pages</li>
<li>Supplier pages</li>
<li>Search pages</li>
</ul>
<h4 id="the-result">The result</h4>
<p><img src="/assets/images/2017/09/ps1722-performance.png" alt="Performance benchmark"></p>
<p>With this shop with few specific prices in the database, the gain is interesting. Even at low concurrency, the improved local cache reduces the number of SQL queries, and allows 1.7 to have the same level of performances than 1.6.1.</p>
<p>At high concurrency, the gain is even higher because a signification point of contention on the database is removed.</p>
<h3 id="conclusion">Conclusion</h3>
<p>The 1.7.2.2 performance improvement is really interesting at high concurrency, and also lowers the number of SQL queries at low concurrency. However you&rsquo;ll see improvement only if you don&rsquo;t have any global specific price rules in your database, which should be the case most of the time.</p>
<p>To check if you have global specific price rules, just search in your database if you have any results with <code>id_product=0</code> in the <code>specific_price</code> table!</p>
<p>(this article was originally <a href="https://www.softizy.com/blog/prestashop-1-7-performance/">published on Softizy</a>, website of Jocelyn, the author of this performance improvement)</p>


          </article>

            


              <div class="post-meta">
    <div class="row">

      <div class="col-md-4">
        <ul class="details">
          <li class="hidden-md hidden-lg">Sep 22, 2017</li>

          
            <li>
              <i class="icon-tag"></i>
              
  <a class="label label-primary" href="/tag/1.7/">1.7</a>

  <a class="label label-primary" href="/tag/1.7.2.x/">1.7.2.x</a>

  <a class="label label-primary" href="/tag/performance/">performance</a>


            </li>
          

        </ul>
      </div>

      
          <div class="col-md-8">
  <div class="author-details">

    <div class="row">
      <div class="col-md-11 col-md-offset-1">

          
              

                <h5>About the author</h5>

                
    <h4>
      <a href="https://build.prestashop-project.org/authors/jocelynfournier/">Jocelyn Fournier</a>
      <span>CEO &amp; Founder @ Softizy</span>
    </h4>

    





              
          

      </div>

    </div>
  </div>
</div>


<div class="newsletter-section">
  <div class="newsletter-text">
    <p>Want to stay up-to-date with the PrestaShop project and the technical development of PrestaShop?</p>
  </div>

  <div class="subscribe-btn-container">
    <a id="subscribe-button" class="btn btn-lg btn-success">Subscribe to our newsletter</a>
  </div>

  <div id="subscription-form" class="subscription-form">
    <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>
    <script>
      hbspt.forms.create({
        region: "na1",
        portalId: "4323170",
        formId: "94e069e0-99ec-4c38-964a-82a27750044e"
      });
    </script>
  </div>
</div>

<script>
  document.getElementById('subscribe-button').addEventListener('click', function () {
    var formDiv = document.getElementById('subscription-form');
    formDiv.style.display = (formDiv.style.display === 'none' || formDiv.style.display === '') ? 'block' : 'none';
  });
</script>

<style>
  .newsletter-section {
    border-top: 1px solid #e8e8e8;
    padding: 20px;
    margin: 0 auto;
    text-align: center;
    display: flex; flex-direction: column;
  }

  .newsletter-text {
    margin: auto;
    max-width: 80%;
    align-content: center;
  }

  .newsletter-text p {
    font-size: 16px;
    line-height: 1.5;
    color: #595959;
  }

  .subscribe-btn-container {
    margin-bottom: 20px;
  }

  #subscription-form {
    display: none;
    margin-top: 20px;
    text-align: left;
  }
</style>
      

    </div>
  </div>


        </div>
      </div>

      <div class="row">
  <div class="col-md-12">
    <div id="disqus_thread"></div><div id="disqus_thread"></div>
        <script type="application/javascript">
          window.disqus_config = function () {
              
              
              this.page.url = 'https:\/\/build.prestashop-project.org\/news\/prestashop-1-7-2-2-performance';
          };
          (function() {
            if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
              document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
              return;
            }
            var d = document, s = d.createElement('script'); s.async = true;
            s.src = '//' + "prestashopbuild" + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
</div>

    </div>

      </div>
    </div>

    <footer class="site-footer">
  <div class="container">

    <div class="row">
      <div class="col-sm-12 col-md-8 col-md-offset-2">
        <p>Official PrestaShop project blog written by
          <a href="/authors">its members and contributors</a>.
        </p>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-md-8 col-md-offset-2">
        <p>
          <a href="https://www.prestashop-project.org" target="_self" title="Create your online store with PrestaShop">
            <img id="logo-dotcom" src="/assets/images/theme/2024-logo.svg" alt="Create your online store">
          </a>
        </p>
      </div>
    </div>

    <div class="row">
      <div id="social-icons" class="col-sm-12 col-md-6 col-md-offset-3">

        

        <a href="https://www.youtube.com/@prestashopproject/" title="YouTube channel">
          <i class="icon-youtube-alt"></i>
        </a>

        
        <a href="https://github.com/PrestaShop" title="GitHub repository">
          <i class="icon-github-alt"></i>
        </a>
        

        
        <a href="https://twitter.com/PrestaShopOrg" title="Twitter account">
          <i class="icon-twitter-alt"></i>
        </a>
        

        

        <a href="/feed.xml" title="RSS feed for this blog">
          <i class="icon-rss"></i>
        </a>

      </div>
    </div>

  </div>
</footer>




<script type="text/javascript" src="/js/vendors/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/js/vendors/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/vendors/md5.js"></script>

<script type="text/javascript" src="/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script type="text/javascript">

    var client = algoliasearch("17LZR6CZEL", "79e7d4e77871f415092b78b82a66eaf0");
    var index = client.initIndex('blog');

    
    autocomplete('#aa-search-input',
      { hint: false, debug: false, autoselect: false, minLength: 4 }, {
        source: autocomplete.sources.hits(index, {hitsPerPage: 6}),
        
        displayKey: 'name',
        
        templates: {
          
          suggestion: function(hit) {
            var str =
              '<a href="' + hit.url + '">' +
              '<span class="hit-title"> ' + hit._highlightResult.title.value + '</span>' +
              '</a>'
            ;

            return str;
          },
          
          empty: function() {
            return '<div class="empty-result">Sorry we couldn\'t find anything.</div>';
          },
          footer: function() {
            return '<p class="algolia-credits">Powered by <img src="/assets/images/theme/algolia.jpg"></p>';
          }
        }
      });
  </script>




  </body>

</html>

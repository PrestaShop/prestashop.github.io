<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Security issue with PHPUnit, post-incident analysis</title>
    <link href="/style.css?1705579082" rel="stylesheet">

    <link rel="shortcut icon" type="image/png" href="/favicon.ico" />

    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    
<meta property="og:title" content="Security issue with PHPUnit, post-incident analysis" />
<meta property="og:description" content="Early January, we encountered a security issue with PHPUnit in some modules that allowed attackers to perform arbitrary code execution without authorization through the PHPUnit dependency. This vulnerability was discovered through a merchant whose shops were compromised." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://build.prestashop-project.org/news/2020/phpunit-security-issue-post-analysis/" />
    <meta property="article:section" content="news" />
    <meta property="article:published_time" content="2020-02-28T10:00:00+01:00" />
    <meta property="article:modified_time" content="2020-02-28T10:00:00+01:00" />

  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:image" content="https://build.prestashop-project.org/assets/images/theme/meta-logo-build-2024.png">
<meta name="twitter:title" content="Security issue with PHPUnit, post-incident analysis"/>
<meta name="twitter:description" content="The mysterious development dependencies!"/>
<meta name="twitter:site" content="@PrestaShopOrg"/>

		<script async src="https://www.googletagmanager.com/gtag/js?id=G-QVW3BYSGJJ"></script>
		<script>
			var doNotTrack = false;
			if (!doNotTrack) {
				window.dataLayer = window.dataLayer || [];
				function gtag(){dataLayer.push(arguments);}
				gtag('js', new Date());
				gtag('config', 'G-QVW3BYSGJJ', { 'anonymize_ip': false });
			}
		</script>
	
    
</head>


  <body>

  <header class="site-header">

  <div class="container">
    <div class="row clearfix">

      <div class="menu-button"><i class="icon icon-store"></i></div>
      <div class="search-button"><i class="icon icon-magnifying-glass"></i></div>

      <div id="logo" class="">
        
        <a href="https://build.prestashop-project.org">
          <img src="/assets/images/theme/2024-logo.svg" alt="PrestaShop Developers&#39; blog Logo">
        </a>
      </div>

      <div id="navigation" class="">
        <nav>
  <ul id="main-navigation" class="nav navbar-nav navbar-collapse">
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        News <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/tag/releases/">Latest releases</a></li>
        <li><a href="/tag/core-monthly/">Core Monthly</a></li>
        <li><a href="/tag/event/">Events &amp; Live Updates</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Project <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/tag/8.1/">Articles on 8.1</a></li>
        <li><a href="/tag/8.0/">Articles on 8.0</a></li>
        <li><a href="/tag/1.7/">Articles on 1.7</a></li>
        <li><a href="/tag/1.6/">Articles on 1.6</a></li>
        <li><a href="https://nightly.prestashop-project.org">Nightly Builds</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Contribute <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/howtos/misc/contribute-to-prestashop/">Contributor's guide</a></li>
        <li><a href="http://contributors.prestashop-project.org/">Contributor's page</a></li>
        <li><a href="http://translators.prestashop.com/">Translators' page</a></li>
      </ul>
    </li>
    <li class="dropdown">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
        Learn <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        <li><a href="/howtos/">How-tos</a></li>
        <li><a href="/tools/">Tools</a></li>
        <li><a href="https://devdocs.prestashop-project.org/">Devdocs</a></li>
        <li><a href="/news/how-to-best-contact-us/">How to best contact us</a></li>
      </ul>
    </li>
    <li class="">
      <a href="/about/">About</a>
    </li>
  </ul>
</nav>

      </div>

      <div id="algolia-container">
        <div class="aa-input-container" id="aa-input-container">
          <input type="search" id="aa-search-input" class="aa-input-search form-control" placeholder="Search..." name="search" autocomplete="off" />
        </div>
      </div>

    </div>
  </div>

</header>


    <div class="page-content">
      <div class="container">
        
  <div class="post">

      <div class="row">
        <div class="col-sm-12">

          <header class="post-header">
            <h1 class="post-title">Security issue with PHPUnit, post-incident analysis</h1>
              
                <h3 class="post-subtitle">The mysterious development dependencies!</h3>
              
          </header>

        </div>
      </div>


      <div class="row">
        <div id="post-sidebar" class="col-md-2">

          <aside class="author">
              <div class="author-avatar clearfix">
  
  
      <a href="https://build.prestashop-project.org/authors/PierreRambaud/">
        <img class="img-circle" src="https://avatars2.githubusercontent.com/u/1462701?s=400&amp;v=4" alt="Pierre Rambaud's picture">
      </a>
  
      <a href="https://build.prestashop-project.org/authors/PrestaShop/">
        <img class="img-circle" src="/assets/images/authors/prestashop-team.png" alt="PrestaShop team's picture">
      </a>
  
</div>

<div class="aside-meta">Written by</div>
<div class="author-name">
  
    <div class="author-item">
      <div class="author-display-name">
        <a href="https://build.prestashop-project.org/authors/PierreRambaud/">Pierre Rambaud</a>
      </div>
        
          <div class="author-display-role">Senior Core Developer</div>
        
    </div>
  
    <div class="author-item">
      <div class="author-display-name">
        <a href="https://build.prestashop-project.org/authors/PrestaShop/">PrestaShop team</a>
      </div>
        
    </div>
  
</div>

          </aside>

          <aside class="post-meta-sidebar">
              <div class="aside-meta">Published</div>
<p class="publish-date">
    Feb 28, 2020
</p>

          </aside>

          <aside class="share-buttons">
              <div class="aside-meta">Share this</div>

<a href="https://twitter.com/intent/tweet?text=Security&#43;issue&#43;with&#43;PHPUnit%2C&#43;post-incident&#43;analysis&amp;url=https%3A%2F%2Fbuild.prestashop-project.org%2Fnews%2F2020%2Fphpunit-security-issue-post-analysis%2F&amp;via=PrestaShopOrg&amp;related=PrestaShopOrg" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="icon-twitter-alt"></i>
</a>

<a href="https://facebook.com/sharer.php?u=https%3A%2F%2Fbuild.prestashop-project.org%2Fnews%2F2020%2Fphpunit-security-issue-post-analysis%2F" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="icon-facebook-alt"></i>
</a>

          </aside>

        </div>

        <div class="col-md-10">

          <article class="post-content">

              <p>Early January, we encountered a <a href="https://build.prestashop.com/news/critical-security-vulnerability-in-prestashop-modules/">security issue with PHPUnit</a> in some modules that allowed attackers to perform arbitrary code execution without authorization through the PHPUnit dependency. This vulnerability was discovered through a merchant whose shops were compromised.</p>
<h2 id="background">Background</h2>
<p>At PrestaShop, we use an automated system to build packages for native modules and make them available through the Addons Marketplace API. This process uses Composer to install dependencies before creating the zip package. During the step, by mistake, development dependencies (like PHPUnit) were not being excluded and found their way in built packages.</p>
<p>This was a code error which was fixed after a short time, but the badly built archives had already been distributed to active shops. At that time, this was considered not to be an issue, since the number of modules including development dependencies was fairly small, and we weren&rsquo;t aware of any vulnerability involving said dependencies.</p>
<p>However, when the PrestaShop software upgrades a module, it only overwrites old files with new ones. It doesn&rsquo;t remove files which existed in the previous version and no longer exist in the newer version.</p>
<p>This means that if a module including vulnerable files is installed, then updated to a newer version which no longer includes those files, the vulnerable files will not be removed and remain as they were.</p>
<h2 id="communication">Communication</h2>
<p>The security team reached out to other major CMS teams in order to inform them about the issue so they could check whether it affected modules or plugins on their side.</p>
<p>Since last year&rsquo;s <a href="https://build.prestashop.com/news/we-were-at-the-cms-security-summit-with-google/">Google CMS Security summit</a>, we have been part of a Slack channel that gathers many people from the CMS ecosystem (Wordpress, Joomla, host providers, etc.) to share security issues. This allows us to share information frequently.</p>
<p>Once the full scope of the vulnerability was confirmed, and after verifying that users would be protected against the vulnerability by upgrading vulnerable modules to the latest version, we communicated through multiple channels to inform our users and the PrestaShop community at large about the incident.</p>
<p>Finally, we communicated through our social networks to warn the community.</p>
<p>Since this day, we still communicate with community members who reach us to inform them about the nature of the vulnerability and provide guidance about what to do if they find themselves impacted.</p>
<h2 id="technical-changes">Technical changes</h2>
<p>All PrestaShop and module archives have been checked, and the faulty archives have been updated.
Latest releases of the corrupted modules no longer contain the vulnerable PHPUnit vendor directory and, during upgrade process, they now delete any remaining instance of that directory if found.</p>
<p>There was no need to fix our pipeline which builds modules ZIP archive as it was already secure. The vulnerability was only present for the modules built before the pipeline was fixed and that were not rebuilt.</p>
<h2 id="next-steps">Next steps</h2>
<p>A <a href="https://en.wikipedia.org/wiki/Bug_bounty_program">Bug Bounty program</a> will be launched very soon with <a href="https://www.yeswehack.com/">YesWeHack</a> and will help to prevent this kind of issue by promoting security researchers to search and report security issues.</p>
<p>Internal processes and tools are also being improved to make sure similar issues will not happen again in the future. Multiple solutions are being explored to detect such vulnerabilities before they are released.</p>
<p>If you just discovered this article, please refer to <a href="https://build.prestashop.com/news/critical-security-vulnerability-in-prestashop-modules/">https://build.prestashop.com/news/critical-security-vulnerability-in-prestashop-modules/ </a> to make sure you are not impacted by the vulnerability or if you are impacted, help you to remove the vulnerable files and protect your shop.</p>


          </article>

            


              <div class="post-meta">
    <div class="row">

      <div class="col-md-4">
        <ul class="details">
          <li class="hidden-md hidden-lg">Feb 28, 2020</li>

          
            <li>
              <i class="icon-tag"></i>
              
  <a class="label label-primary" href="/tag/maintenance/">maintenance</a>

  <a class="label label-primary" href="/tag/patch/">patch</a>

  <a class="label label-primary" href="/tag/modules/">modules</a>

  <a class="label label-primary" href="/tag/security/">security</a>


            </li>
          

        </ul>
      </div>

      
          <div class="col-md-8">
  <div class="author-details">

    <div class="row">
      <div class="col-md-11 col-md-offset-1">

          

            <h5>About the authors</h5>

            
              <div class="author-item">
                  
    <h4>
      <a href="https://build.prestashop-project.org/authors/PierreRambaud/">Pierre Rambaud</a>
      <span class="multiple">Senior Core Developer</span>
    </h4>

    





              </div>
            
              <div class="author-item">
                  
    <h4>
      <a href="https://build.prestashop-project.org/authors/PrestaShop/">PrestaShop team</a>
      <span class="multiple"></span>
    </h4>

    





              </div>
            

          

      </div>

    </div>
  </div>
</div>

      

    </div>
  </div>


        </div>
      </div>

      <div class="row">
  <div class="col-md-12">
    <div id="disqus_thread"></div><div id="disqus_thread"></div>
        <script type="application/javascript">
          window.disqus_config = function () {
              
              
              this.page.url = 'https:\/\/build.prestashop-project.org\/news\/phpunit-security-issue-post-analysis';
          };
          (function() {
            if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
              document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
              return;
            }
            var d = document, s = d.createElement('script'); s.async = true;
            s.src = '//' + "prestashopbuild" + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
</div>

    </div>

      </div>
    </div>

    <footer class="site-footer">
  <div class="container">

    <div class="row">
      <div class="col-sm-12 col-md-8 col-md-offset-2">
        <p>Official PrestaShop project blog written by
          <a href="/authors">its members and contributors</a>.
        </p>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12 col-md-8 col-md-offset-2">
        <p>
          <a href="https://www.prestashop-project.org" target="_self" title="Create your online store with PrestaShop">
            <img id="logo-dotcom" src="/assets/images/theme/logo-prestashop-com.png" alt="Create your online store">
          </a>
        </p>
      </div>
    </div>

    <div class="row">
      <div id="social-icons" class="col-sm-12 col-md-6 col-md-offset-3">

        

        <a href="https://www.youtube.com/@prestashopproject/" title="YouTube channel">
          <i class="icon-youtube-alt"></i>
        </a>

        
        <a href="https://github.com/PrestaShop" title="GitHub repository">
          <i class="icon-github-alt"></i>
        </a>
        

        
        <a href="https://twitter.com/PrestaShopOrg" title="Twitter account">
          <i class="icon-twitter-alt"></i>
        </a>
        

        

        <a href="/feed.xml" title="RSS feed for this blog">
          <i class="icon-rss"></i>
        </a>

      </div>
    </div>

  </div>
</footer>




<script type="text/javascript" src="/js/vendors/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/js/vendors/bootstrap.min.js"></script>

<script type="text/javascript" src="/js/vendors/md5.js"></script>

<script type="text/javascript" src="/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
  <script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.min.js"></script>
  <script type="text/javascript">

    var client = algoliasearch("17LZR6CZEL", "79e7d4e77871f415092b78b82a66eaf0");
    var index = client.initIndex('blog');

    
    autocomplete('#aa-search-input',
      { hint: false, debug: false, autoselect: false, minLength: 4 }, {
        source: autocomplete.sources.hits(index, {hitsPerPage: 6}),
        
        displayKey: 'name',
        
        templates: {
          
          suggestion: function(hit) {
            var str =
              '<a href="' + hit.url + '">' +
              '<span class="hit-title"> ' + hit._highlightResult.title.value + '</span>' +
              '</a>'
            ;

            return str;
          },
          
          empty: function() {
            return '<div class="empty-result">Sorry we couldn\'t find anything.</div>';
          },
          footer: function() {
            return '<p class="algolia-credits">Powered by <img src="/assets/images/theme/algolia.jpg"></p>';
          }
        }
      });
  </script>




  </body>

</html>
